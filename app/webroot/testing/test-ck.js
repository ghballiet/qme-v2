$(document).ready(function(){function c(a){a.attr("opacity",.5)}function d(a,b,c){var d=e(a),g=f(a)}function e(a){return d3.select('.link[data-start="'+a+'"]')}function f(a){return d3.select('.link[data-end="'+a+'"]')}function g(a){a.transition().duration(200).attr("opacity",1)}function i(b,c){var d=b.selectAll("g.place").data(c),e=d.enter().append("g").attr("class","place").attr("data-id",function(a){return a.id}).attr("data-name",function(a){return a.name}).attr("opacity",1).call(a);e.append("rect").attr("width",function(a){return a.width}).attr("height",function(a){return a.height}).attr("x",function(a){return a.x}).attr("y",function(a){return a.y});e.append("text").attr("text-anchor","middle").attr("x",function(a){return a.x+a.width/2}).attr("y",function(a){return a.y}).attr("dy","1.2em").text(function(a){return a.name});var f=e.filter(function(a){return a.entities});f[0].length>0&&f.call(j,f.datum().entities);var g=e.filter(function(a){return a.children});g[0].length>0&&g.call(i,g.datum().children)}function j(a,c){var d=a.selectAll("g.entity").data(c),e=d.enter().append("g").attr("class",function(a){return"entity "+a.type}).attr("data-id",function(a){return a.id}).attr("data-name",function(a){return a.name}).attr("opacity",1).call(b);e.append("rect").attr("width",function(a){return a.width}).attr("height",function(a){return a.height});e.append("text").attr("text-anchor","middle").attr("x",function(a){return 50}).attr("dy","1.2em").text(function(a){return a.name})}function k(a){var b=d3.select('.entity[data-id="'+a+'"]').datum(),c=b.x,d=b.y,e=b.width,f=b.height,g=b.x+b.width/2,h=b.y+b.height/2;return{x:g,y:h}}function l(a){var b=d3.svg.diagonal().source(function(a,b){return k(a.start)}).target(function(a,b){return k(a.end)}),c=h.selectAll("path.link").data(a),d=c.enter().append("path").attr("class",function(a){return"link "+a.type}).attr("data-start",function(a){return a.start}).attr("data-end",function(a){return a.end}).attr("d",b)}function m(){d3.json("data.json",function(a){i(h,a.entities)});n()}function n(){d3.json("data.json",function(a){l(a.links)})}var a=d3.behavior.drag().on("dragstart",function(a,b){d3.select(this).call(c);d3.select(".link").remove()}).on("drag",function(a,b){a.x+=d3.event.dx;a.y+=d3.event.dy;d3.select(this).attr("transform","translate("+a.x+","+a.y+")")}).on("dragend",function(){d3.select(this).call(g);n()}),b=d3.behavior.drag().on("dragstart",function(a,b){d3.select(this).call(c);d3.select(".link").remove()}).on("drag",function(a,b){a.x+=d3.event.dx;a.y+=d3.event.dy;item=d3.select(this);item.attr("transform","translate("+a.x+","+a.y+")");item.attr("x",a.x);item.attr("y",a.y)}).on("dragend",function(){d3.select(this).call(g);n()}),h=d3.select("#canvas").append("svg");m()});